<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Simulador de Rendimento TVDE</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.14/jspdf.plugin.autotable.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f4f6f8;
            color: #333;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 30px;
        }
        h1 {
            text-align: center;
            color: #1a73e8;
            margin-bottom: 10px;
        }
        h2 {
            text-align: center;
            font-weight: normal;
            color: #555;
            margin-bottom: 30px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 6px;
        }
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 15px;
        }
        /* REMOVIDO: .inline-inputs para evitar a compress√£o. */
        .btn {
            background: #1a73e8;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 15px;
            border-radius: 8px;
            cursor: pointer;
            margin-right: 10px;
            margin-top: 10px;
        }
        .btn:hover {
            background: #155ab6;
        }
        /* MELHORIA DO LAYOUT DO RESULTADO */
        .resultado {
            margin-top: 25px;
            padding: 20px; 
            background: #e8f0fe;
            border-left: 5px solid #1a73e8;
            border-radius: 8px;
            font-size: 1.1em; 
            line-height: 1.8;
            white-space: pre-wrap; 
            font-weight: 500;
        }
        .aviso-negativo {
            color: #d93025;
            font-weight: bold;
        }
        /* CORRE√á√ÉO DO LAYOUT DO GR√ÅFICO */
        #graficoRendimento {
            margin-top: 30px;
            max-width: 100%;
            height: 300px; 
            display: block; /* Garante que ocupa a linha */
        }
        footer {
            margin-top: 50px;
            text-align: center;
            font-size: 14px;
            color: #777;
            /* Garante que o rodap√© fica vis√≠vel no fundo */
            padding-top: 20px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Simulador de Rendimento TVDE</h1>
        <h2>Calcula o teu lucro l√≠quido com base nos teus dados reais</h2>

        <div class="input-group">
            <label for="horas">Horas trabalhadas</label>
            <input type="number" id="horas" placeholder="Ex: 8" value="4">
        </div>

        <div class="input-group">
            <label for="km">Quil√≥metros percorridos</label>
            <input type="number" id="km" placeholder="Ex: 165" value="150">
        </div>
        
        <div class="input-group">
            <label for="ganhos">Ganhos brutos (‚Ç¨)</label>
            <input type="number" id="ganhos" placeholder="Ex: 150" value="106">
        </div>

        <div class="input-group">
            <label for="custoKm">Custo estimado por km (‚Ç¨)</label>
            <input type="number" id="custoKm" placeholder="Ex: 0.25" value="0.46">
        </div>
        
        <button class="btn" onclick="calcularRendimento()">Calcular Rendimento</button>
        <button class="btn" onclick="exportarPDF()">üìÑ Exportar para PDF</button>

        <div class="resultado" id="resultado"></div>
        
        <canvas id="graficoRendimento"></canvas>
    </div>

    <footer>
        Desenvolvido por Voz Do Condutor ‚Äî Plataforma de apoio ao motorista TVDE
    </footer>

    <script>
        let grafico;

        function calcularRendimento() {
            const horas = parseFloat(document.getElementById('horas')?.value);
            const km = parseFloat(document.getElementById('km')?.value);
            const ganhos = parseFloat(document.getElementById('ganhos')?.value);
            const custoKm = parseFloat(document.getElementById('custoKm')?.value);

            if (isNaN(horas) || isNaN(km) || isNaN(ganhos) || isNaN(custoKm)) {
                document.getElementById('resultado').innerHTML = `<span class="aviso-negativo">
                    ‚ö†Ô∏è Por favor, preencha todos os campos com n√∫meros v√°lidos.
                </span>`;
                if (grafico) grafico.destroy(); 
                return;
            }

            const custoTotal = km * custoKm;
            const lucroLiquido = ganhos - custoTotal;
            const lucroHora = horas ? (lucroLiquido / horas).toFixed(2) : '‚Äî';
            const lucroKm = km ? (lucroLiquido / km).toFixed(2) : '‚Äî';

            let aviso = 'O lucro l√≠quido √© um indicador financeiro que mostra o que realmente ganhou ap√≥s deduzir os seus custos.';
            
            if (lucroLiquido <= 0) {
                aviso = '<span class="aviso-negativo">‚ö†Ô∏è **ATEN√á√ÉO:** O seu Lucro L√≠quido √© negativo. Os seus custos absorveram o seu ganho bruto.</span>';
            }
            
            document.getElementById('resultado').innerHTML = `
                <strong>Ganhos brutos:</strong> ${ganhos.toFixed(2)}‚Ç¨<br>
                <strong>Custo total estimado:</strong> ${custoTotal.toFixed(2)}‚Ç¨<br>
                <strong style="color: ${lucroLiquido > 0 ? '#34a853' : '#d93025'}">Lucro l√≠quido: ${lucroLiquido.toFixed(2)}‚Ç¨</strong><br>
                <strong style="color: ${lucroLiquido > 0 ? '#1a73e8' : '#d93025'}">Lucro por hora: ${lucroHora}‚Ç¨/h</strong><br>
                <strong>Lucro por quil√≥metro:</strong> ${lucroKm}‚Ç¨/km<br><br>
                ${aviso}
            `;

            const ctx = document.getElementById('graficoRendimento').getContext('2d');
            const dados = {
                labels: ['Lucro/h', 'Lucro/km'],
                datasets: [{
                    label: 'Rendimento',
                    data: [parseFloat(lucroHora) || 0, parseFloat(lucroKm) || 0],
                    backgroundColor: [
                        (parseFloat(lucroHora) || 0) > 0 ? '#1a73e8' : '#d93025',
                        (parseFloat(lucroKm) || 0) > 0 ? '#34a853' : '#d93025'
                    ]
                }]
            };

            if (grafico) grafico.destroy();
            grafico = new Chart(ctx, {
                type: 'bar',
                data: dados,
                options: {
                    responsive: true,
                    maintainAspectRatio: false, 
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: 'Rendimento por hora vs km' }
                    },
                    scales: {
                        y: {
                            beginAtZero: false 
                        }
                    }
                }
            });
        }

        async function exportarPDF() {
            if (document.getElementById('resultado').innerHTML === '') {
                calcularRendimento();
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const campos = [
                { label: "Horas trabalhadas", value: document.getElementById('horas')?.value },
                { label: "Km percorridos", value: document.getElementById('km')?.value },
                { label: "Ganhos brutos (‚Ç¨)", value: document.getElementById('ganhos')?.value },
                { label: "Custo estimado por km (‚Ç¨)", value: document.getElementById('custoKm')?.value }
            ];
            
            doc.setFontSize(14);
            doc.text("Simulador de Rendimento TVDE", 20, 20);
            doc.setFontSize(12);
            doc.text("üìã Dados inseridos:", 20, 30);

            let y = 36;
            campos.forEach(campo => {
                doc.text(`${campo.label}: ${campo.value || '‚Äî'}`, 20, y);
                y += 6;
            });

            const resultadoElement = document.getElementById('resultado');
            const resultadoTexto = resultadoElement.innerText.trim();
            const linhas = doc.splitTextToSize(resultadoTexto, 170);

            doc.text("üìä Resultados:", 20, y + 6);
            doc.text(linhas, 20, y + 12);
            
            const canvas = document.getElementById('graficoRendimento');
            if (canvas) {
                calcularRendimento(); 
                const imgData = canvas.toDataURL('image/png');
                doc.addPage();
                doc.text("üìà Gr√°fico de Rendimento", 20, 20);
                doc.addImage(imgData, 'PNG', 15, 30, 180, 90);
            }

            doc.save("simulador-rendimento-tvde.pdf");
        }

        window.onload = () => {
             // O c√°lculo inicial √© feito ao carregar a p√°gina
             calcularRendimento();
        };
    </script>
</body>
</html>
