<!DOCTYPE html>
<html lang="pt">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <title>Simulador de Rendimento TVDE</title>
Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.14/jspdf.plugin.autotable.min.js"></script>
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: 'Segoe UI', sans-serif;
Â  Â  Â  background: #f4f6f8;
Â  Â  Â  color: #333;
Â  Â  Â  padding: 20px;
Â  Â  }
Â  Â  .container {
Â  Â  Â  max-width: 800px;
Â  Â  Â  margin: auto;
Â  Â  Â  background: #fff;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
Â  Â  Â  padding: 30px;
Â  Â  }
Â  Â  h1 {
Â  Â  Â  text-align: center;
Â  Â  Â  color: #1a73e8;
Â  Â  Â  margin-bottom: 10px;
Â  Â  }
Â  Â  h2 {
Â  Â  Â  text-align: center;
Â  Â  Â  font-weight: normal;
Â  Â  Â  color: #555;
Â  Â  Â  margin-bottom: 30px;
Â  Â  }
Â  Â  .input-group {
Â  Â  Â  margin-bottom: 15px;
Â  Â  }
Â  Â  .input-group label {
Â  Â  Â  display: block;
Â  Â  Â  font-weight: bold;
Â  Â  Â  margin-bottom: 6px;
Â  Â  }
Â  Â  .input-group input {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 10px;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-size: 15px;
Â  Â  }
Â  Â  .btn {
Â  Â  Â  background: #1a73e8;
Â  Â  Â  color: #fff;
Â  Â  Â  border: none;
Â  Â  Â  padding: 10px 18px;
Â  Â  Â  font-size: 15px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  margin-right: 10px;
Â  Â  Â  margin-top: 10px;
Â  Â  }
Â  Â  .btn:hover {
Â  Â  Â  background: #155ab6;
Â  Â  }
Â  Â  .resultado {
Â  Â  Â  margin-top: 25px;
Â  Â  Â  padding: 15px;
Â  Â  Â  background: #e8f0fe;
Â  Â  Â  border-left: 5px solid #1a73e8;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  line-height: 1.5;
Â  Â  }
Â  Â  .aviso-negativo {
Â  Â  Â  color: #d93025;
Â  Â  Â  font-weight: bold;
Â  Â  }
Â  Â  canvas {
Â  Â  Â  margin-top: 30px;
Â  Â  Â  max-width: 100%;
Â  Â  }
Â  Â  footer {
Â  Â  Â  margin-top: 50px;
Â  Â  Â  text-align: center;
Â  Â  Â  font-size: 14px;
Â  Â  Â  color: #777;
Â  Â  }
Â  </style>
</head>
<body>
Â  <div class="container">
Â  Â  <h1>Simulador de Rendimento TVDE</h1>
Â  Â  <h2>Calcula o teu lucro lÃ­quido com base nos teus dados reais</h2>

Â  Â  <div class="input-group">
Â  Â  Â  <label for="horas">Horas trabalhadas</label>
Â  Â  Â  <input type="number" id="horas" placeholder="Ex: 8">
Â  Â  </div>

Â  Â  <div class="input-group">
Â  Â  Â  <label for="km">QuilÃ³metros percorridos</label>
Â  Â  Â  <input type="number" id="km" placeholder="Ex: 165">
Â  Â  </div>

Â  Â  <div class="input-group">
Â  Â  Â  <label for="ganhos">Ganhos brutos (â‚¬)</label>
Â  Â  Â  <input type="number" id="ganhos" placeholder="Ex: 150">
Â  Â  </div>

Â  Â  <div class="input-group">
Â  Â  Â  <label for="custoKm">Custo estimado por km (â‚¬)</label>
Â  Â  Â  <input type="number" id="custoKm" placeholder="Ex: 0.25">
Â  Â  </div>

Â  Â  <button class="btn" onclick="calcularRendimento()">Calcular Rendimento</button>
Â  Â  <button class="btn" onclick="exportarPDF()">ğŸ“„ Exportar para PDF</button>

Â  Â  <div class="resultado" id="resultado"></div>
Â  Â  <canvas id="graficoRendimento"></canvas>
Â  </div>

Â  <footer>
Â  Â  Desenvolvido por Voz Do Condutor â€” Plataforma de apoio ao motorista TVDE
Â  </footer>

Â  <script>
Â  Â  let grafico;

Â  Â  function calcularRendimento() {
Â  Â  Â  // Usa o 'parseFloat()' diretamente nos valores para garantir que sÃ£o nÃºmeros.
Â  Â  Â  const horas = parseFloat(document.getElementById('horas')?.value);
Â  Â  Â  const km = parseFloat(document.getElementById('km')?.value);
Â  Â  Â  const ganhos = parseFloat(document.getElementById('ganhos')?.value);
Â  Â  Â  const custoKm = parseFloat(document.getElementById('custoKm')?.value);

Â  Â  Â  // ValidaÃ§Ã£o para garantir que todos os campos estÃ£o preenchidos
Â  Â  Â  if (isNaN(horas) || isNaN(km) || isNaN(ganhos) || isNaN(custoKm)) {
Â  Â  Â  Â  Â  document.getElementById('resultado').innerHTML = `<span class="aviso-negativo">
Â  Â  Â  Â  Â  Â  âš ï¸ Por favor, preencha todos os campos com nÃºmeros vÃ¡lidos.
Â  Â  Â  Â  Â  </span>`;
Â  Â  Â  Â  Â  if (grafico) grafico.destroy(); // Limpa o grÃ¡fico em caso de erro
Â  Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Linha de CÃ¡lculo Corrigida (a fÃ³rmula jÃ¡ estava certa, mas garantimos que estÃ¡ explÃ­cita)
Â  Â  Â  const custoTotal = km * custoKm;
Â  Â  Â  const lucroLiquido = ganhos - custoTotal;
Â  Â  Â  const lucroHora = horas ? (lucroLiquido / horas).toFixed(2) : 'â€”';
Â  Â  Â  const lucroKm = km ? (lucroLiquido / km).toFixed(2) : 'â€”';

Â  Â  Â  // Mensagem de aviso condicional
Â  Â  Â  let aviso = 'O lucro lÃ­quido Ã© um indicador financeiro que mostra o que realmente ganhou apÃ³s deduzir os seus custos (0,46â‚¬/km).';
Â  Â  Â  if (lucroLiquido <= 0) {
Â  Â  Â  Â  Â  aviso = '<span class="aviso-negativo">âš ï¸ **ATENÃ‡ÃƒO:** O seu Lucro LÃ­quido Ã© negativo. Os seus custos absorveram o seu ganho bruto.</span>';
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  document.getElementById('resultado').innerHTML = `
Â  Â  Â  Â  <strong>Ganhos brutos:</strong> ${ganhos.toFixed(2)}â‚¬<br>
Â  Â  Â  Â  <strong>Custo total estimado:</strong> ${custoTotal.toFixed(2)}â‚¬<br>
Â  Â  Â  Â  <strong>Lucro lÃ­quido:</strong> ${lucroLiquido.toFixed(2)}â‚¬<br>
Â  Â  Â  Â  <strong>Lucro por hora:</strong> ${lucroHora}â‚¬/h<br>
Â  Â  Â  Â  <strong>Lucro por quilÃ³metro:</strong> ${lucroKm}â‚¬/km<br><br>
Â  Â  Â  Â  ${aviso}
Â  Â  Â  `;

Â  Â  Â  const ctx = document.getElementById('graficoRendimento').getContext('2d');
Â  Â  Â  const dados = {
Â  Â  Â  Â  labels: ['Lucro por hora', 'Lucro por km'],
Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  label: 'Rendimento',
Â  Â  Â  Â  Â  data: [parseFloat(lucroHora) || 0, parseFloat(lucroKm) || 0],
Â  Â  Â  Â  Â  backgroundColor: ['#1a73e8', '#34a853']
Â  Â  Â  Â  }]
Â  Â  Â  };

Â  Â  Â  if (grafico) grafico.destroy();
Â  Â  Â  grafico = new Chart(ctx, {
Â  Â  Â  Â  type: 'bar',
Â  Â  Â  Â  data: dados,
Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  responsive: true,
Â  Â  Â  Â  Â  plugins: {
Â  Â  Â  Â  Â  Â  legend: { display: false },
Â  Â  Â  Â  Â  Â  title: { display: true, text: 'Rendimento por hora vs km' }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  }

Â  Â  async function exportarPDF() {
Â  Â  Â  // Verifica se a funÃ§Ã£o calcularRendimento foi executada antes
Â  Â  Â  if (document.getElementById('resultado').innerHTML === '') {
Â  Â  Â  Â  calcularRendimento(); // Garante que os resultados estÃ£o calculados
Â  Â  Â  }

Â  Â  Â  const { jsPDF } = window.jspdf;
Â  Â  Â  const doc = new jsPDF();

Â  Â  Â  const campos = [
Â  Â  Â  Â  { label: "Horas trabalhadas", value: document.getElementById('horas')?.value },
Â  Â  Â  Â  { label: "Km percorridos", value: document.getElementById('km')?.value },
Â  Â  Â  Â  { label: "Ganhos brutos (â‚¬)", value: document.getElementById('ganhos')?.value },
Â  Â  Â  Â  { label: "Custo estimado por km (â‚¬)", value: document.getElementById('custoKm')?.value }
Â  Â  Â  ];

Â  Â  Â  doc.setFontSize(14);
Â  Â  Â  doc.text("Simulador de Rendimento TVDE", 20, 20);
Â  Â  Â  doc.setFontSize(12);
Â  Â  Â  doc.text("ğŸ“‹ Dados inseridos:", 20, 30);

Â  Â  Â  let y = 36;
Â  Â  Â  campos.forEach(campo => {
Â  Â  Â  Â  doc.text(`${campo.label}: ${campo.value || 'â€”'}`, 20, y);
Â  Â  Â  Â  y += 6;
Â  Â  Â  });

Â  Â  Â  const resultado = document.getElementById('resultado')?.innerText;
Â  Â  Â  // Remove a mensagem de aviso condicional para o PDF
Â  Â  Â  const linhas = doc.splitTextToSize(resultado, 170);

Â  Â  Â  doc.text("ğŸ“Š Resultados:", 20, y + 6);
Â  Â  Â  doc.text(linhas, 20, y + 12);

Â  Â  Â  const canvas = document.getElementById('graficoRendimento');
Â  Â  Â  const imgData = canvas.toDataURL('image/png');
Â  Â  Â  doc.addPage();
Â  Â  Â  doc.text("ğŸ“ˆ GrÃ¡fico de Rendimento", 20, 20);
Â  Â  Â  doc.addImage(imgData, 'PNG', 15, 30, 180, 90);

Â  Â  Â  doc.save("simulador-rendimento-tvde.pdf");
Â  Â  }

Â  Â  // Executa o cÃ¡lculo ao carregar a pÃ¡gina se houver valores
Â  Â  window.onload = () => {
Â  Â  Â  if (document.getElementById('horas')?.value && document.getElementById('km')?.value) {
Â  Â  Â  Â  calcularRendimento();
Â  Â  Â  }
Â  Â  };
Â  </script>
</body>
</html>
